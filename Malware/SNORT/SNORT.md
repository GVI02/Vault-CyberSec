#snort #malware 

>[!note]
>https://www.snort.org

> Snort is the foremost Open Source Intrusion Prevention System (IPS) in the world. Snort IPS uses a series of rules that help define malicious network activity and uses those rules to find packets that match against them and generates alerts for users.

> Snort can be deployed inline to stop these packets, as well. Snort has three primary uses: As a packet sniffer like tcpdump, as a packet logger — which is useful for network traffic debugging, or it can be used as a full-blown network intrusion prevention system. Snort can be downloaded and configured for personal and business use alike.


All rules and configurations, including plugins, are saved in a **.conf** file (configuration file).

**Main** Components of Snort

- **Packet Decoder -** Packet collector component of Snort. It collects and prepares the packets for pre-processing. 
- **Pre-processors -** A component that arranges and modifies the packets for the detection engine.
- **Detection Engine -** The primary component that process, dissect and analyse the packets by applying the rules. 
- Logging and Alerting - Log and alert generation component.
- Outputs and Plugins - Output integration modules (i.e. alerts to syslog/mysql) and additional plugin (rule management detection plugins) support is done with this component.

**There are three types of rules available for snort**

- Community Rules - Free ruleset under the GPLv2. Publicly accessible, no need for registration.
- Registered Rules - Free ruleset (requires registration). This ruleset contains subscriber rules with 30 days delay.
- Subscriber Rules (Paid) - Paid ruleset (requires subscription). This ruleset is the main ruleset and is updated twice a week (Tuesdays and Thursdays).

- snort.conf: _Main configuration file._
- local.rules: _User-generated rules file._

###### <span class="purple-highlight-light">Setting up the config file</span>

**Navigate to the "Step #1: Set the network variables." section.**

This section manages the scope of the detection and rule paths.  

| **TAG NAME**      | **INFO**                                                                            | **EXAMPLE**               |
| ----------------- | ----------------------------------------------------------------------------------- | ------------------------- |
| HOME_NET          | That is where we are protecting.                                                    | 'any' OR '192.168.1.1/24' |
| EXTERNAL_NET      | This field is the external network, so we need to keep it as 'any' or '!$HOME_NET'. | 'any' OR '!$HOME_NET'     |
| RULE_PATH         | Hardcoded rule path.                                                                | /etc/snort/rules          |
| SO_RULE_PATH      | _These rules come with registered and subscriber rules._                            | $RULE_PATH/so_rules       |
| PREPROC_RULE_PATH | _These rules come with registered and subscriber rules._                            | $RULE_PATH/plugin_rules   |

**Navigate to the "Step #2: Configure the decoder." section.**  

In this section, you manage the IPS mode of snort. The single-node installation model IPS model works best with "afpacket" mode. You can enable this mode and run Snort in IPS.

| **TAG NAME**     | **INFO**                    | **EXAMPLE**     |
| ---------------- | --------------------------- | --------------- |
| config daq:      | IPS mode selection.         | afpacket        |
| config daq_mode: | Activating the inline mode  | inline          |
| config logdir:   | Hardcoded default log path. | /var/logs/snort |
There are six DAQ modules available in Snort;

- **Pcap:** Default mode, known as Sniffer mode.
- **Afpacket:** Inline mode, known as IPS mode.
- **Ipq:** Inline mode on Linux by using Netfilter. It replaces the snort_inline patch.  
- **Nfq:** Inline mode on Linux.
- **Ipfw:** Inline on OpenBSD and FreeBSD by using divert sockets, with the pf and ipfw firewalls.  
- **Dump:** Testing mode of inline and normalisation.

**Navigate to the "Step #6: Configure output plugins" section.**

This section manages the outputs of the IDS/IPS actions, such as logging and alerting format details. The default action prompts everything in the console application, so configuring this part will help you use the Snort more efficiently.

**Navigate to the "Step #7: Customise your ruleset" section.**  

| **TAG NAME**        | **INFO**                                       | **EXAMPLE**                    |
| ------------------- | ---------------------------------------------- | ------------------------------ |
| site specific rules | Hardcoded local and user-generated rules path. | include $RULE_PATH/local.rules |
| include $RULE_PATH/ | Hardcoded default/downloaded rules path.       | include $RULE_PATH/rulename    |

###### <span class="purple-highlight-light">Modes</span>
Snort can run in one of 3 modes.

| Mode                   | Description                                                                            |
| ---------------------- | -------------------------------------------------------------------------------------- |
| [[Sniffer Mode]]       | Read IP packets and prompt them in the console application.                            |
| [[Packet Logger Mode]] | Log all IP packets (inbound and outbound) that visit the network.                      |
| [[NIDS;NIPS Mode]]     | Log/drop the packets that are deemed as malicious according to the user-defined rules. |

###### <span class="purple-highlight-light">Flags</span>

| Flag           | Description                                                                                            |
| -------------- | ------------------------------------------------------------------------------------------------------ |
| -V / --version | This parameter provides information about your instance version.                                       |
| -c             | Identifying the configuration file                                                                     |
| -T             | Snort's self-test parameter, you can test your setup with this parameter.                              |
| -q             | Quiet mode prevents snort from displaying the default banner and initial information about your setup. |
###### <span class="blue-highlight-light">Get SNORT version</span>
```shell
snort -V
```

Example Output:
```
ubuntu@ip-10-10-175-75:~/Desktop/Task-Exercises$ snort -V

   ,,_     -*> Snort! <*-
  o"  )~   Version 2.9.7.0 GRE (Build 149) 
   ''''    By Martin Roesch & The Snort Team: http://www.snort.org/contact#team
           Copyright (C) 2014 Cisco and/or its affiliates. All rights reserved.
           Copyright (C) 1998-2013 Sourcefire, Inc., et al.
           Using libpcap version 1.9.1 (with TPACKET_V3)
           Using PCRE version: 8.39 2016-06-14
           Using ZLIB version: 1.2.11
```

###### <span class="blue-highlight-light">Specify configuration file</span>
```shell
snort -c /etc/snort/snort.conf
```

###### <span class="blue-highlight-light">Test SNORT configuration</span>
```shell
snort -c /etc/snort/snort.conf -T
```

Example output:
```shell
ubuntu@ip-10-10-175-75:~/Desktop/Task-Exercises$ snort -c /etc/snort/snort.conf -T
Running in Test mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
4151 Snort rules read
    3477 detection rules
    0 decoder rules
    0 preprocessor rules
3477 Option Chains linked into 271 Chain Headers
0 Dynamic rules
...
```



